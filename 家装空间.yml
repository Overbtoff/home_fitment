app:
  description: ''
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: è”ç½‘æœç´¢å®¶å±…å®‰è£…_2.0
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai_api_compatible:0.0.16@77274df8fe2632cac66bfd153fcc75aa5e96abbe92b5c611b8984ad9f4cd4457
kind: app
version: 0.1.5
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1746797398965'
        sourceType: iteration-start
        targetType: llm
      id: 1746797398965start-source-1746797407824-target
      source: 1746797398965start
      sourceHandle: source
      target: '1746797407824'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1746797398965'
        sourceType: llm
        targetType: code
      id: 1746797407824-source-1746798461643-target
      source: '1746797407824'
      sourceHandle: source
      target: '1746798461643'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: iteration
        targetType: code
      id: 1746797398965-source-1746803669588-target
      source: '1746797398965'
      sourceHandle: source
      target: '1746803669588'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: end
      id: 1746803669588-source-1746804995053-target
      source: '1746803669588'
      sourceHandle: source
      target: '1746804995053'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1746805617115'
        sourceType: iteration-start
        targetType: llm
      id: 1746805617115start-source-1746805939176-target
      source: 1746805617115start
      sourceHandle: source
      target: '1746805939176'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: parameter-extractor
      id: 1746793901295-source-1746806049812-target
      source: '1746793901295'
      sourceHandle: source
      target: '1746806049812'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: parameter-extractor
        targetType: iteration
      id: 1746806049812-source-1746805617115-target
      source: '1746806049812'
      sourceHandle: source
      target: '1746805617115'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: true
        isInLoop: false
        iteration_id: '1746805617115'
        sourceType: llm
        targetType: code
      id: 1746805939176-source-1746806259993-target
      source: '1746805939176'
      sourceHandle: source
      target: '1746806259993'
      targetHandle: target
      type: custom
      zIndex: 1002
    - data:
        isInLoop: false
        sourceType: iteration
        targetType: iteration
      id: 1746805617115-source-1746797398965-target
      source: '1746805617115'
      sourceHandle: source
      target: '1746797398965'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: llm
      id: 1746793690951-source-1746973196324-target
      source: '1746793690951'
      sourceHandle: source
      target: '1746973196324'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: llm
      id: 1746973196324-source-1746793901295-target
      source: '1746973196324'
      sourceHandle: source
      target: '1746793901295'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: design
          max_length: 8192
          options: []
          required: true
          type: paragraph
          variable: design
        - label: budget
          max_length: 48
          options: []
          required: true
          type: text-input
          variable: budget
        - allowed_file_extensions: []
          allowed_file_types:
          - image
          allowed_file_upload_methods:
          - local_file
          - remote_url
          label: floor_plan
          max_length: 48
          options: []
          required: true
          type: file
          variable: floor_plan
      height: 141
      id: '1746793690951'
      position:
        x: -809.8698747192367
        y: 224.10007990588937
      positionAbsolute:
        x: -809.8698747192367
        y: 224.10007990588937
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            temperature: 0.1
          mode: chat
          name: kimi
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: 9c2b0343-092c-433d-a72c-b442f9a91b32
          role: system
          text: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šå®¤å†…è®¾è®¡å¸ˆåŠ©ç†ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·éœ€æ±‚å¿«é€Ÿæå–å…³é”®ä¿¡æ¯ç”Ÿæˆæˆ¿é—´æ¦‚è§ˆåˆ—è¡¨ã€‚è¯·ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

            è¾“å…¥è¦æ±‚ï¼š

            [æˆ¿é—´æ•°é‡/åç§°]ã€[é¢ç§¯/å°ºå¯¸]ã€[ç¡¬è£…éœ€æ±‚]ã€[è½¯è£…åå¥½]ã€[é£æ ¼è¦æ±‚]ã€[ç‰¹æ®Šéœ€æ±‚]

            è¾“å‡ºè§„åˆ™ï¼š

            {

            "rooms_overview": [

            {

            "name": "æˆ¿é—´åç§°",

            "area": "å¹³æ–¹ç±³æ•°å€¼",

            "hardware_requirements": ["å¢™é¢å¤„ç†éœ€æ±‚","åœ°é¢æè´¨éœ€æ±‚","é‡ç‚¹ç¡¬è£…é¡¹ç›®"],

            "software_requirements": ["æ ¸å¿ƒå®¶å…·éœ€æ±‚","é‡ç‚¹è£…é¥°å…ƒç´ "],

            "special_notes": ["ç‰¹æ®ŠåŠŸèƒ½éœ€æ±‚","ç‰¹æ®Šå°ºå¯¸è¯´æ˜"]

            }

            ],

            "style_keywords": ["ä¸»é£æ ¼","æ¬¡çº§é£æ ¼"],

            "priority_rooms": ["ç”¨æˆ·é‡ç‚¹å…³æ³¨çš„æˆ¿é—´åç§°"]

            }

            å¼ºåˆ¶è¦æ±‚ï¼š

            æ¯ä¸ªæˆ¿é—´é¢ç§¯å¿…é¡»æ¢ç®—ä¸ºå¹³æ–¹ç±³

            è¯†åˆ«å‡ºå‰3ä¸ªé£æ ¼å…³é”®è¯

            è‡³å°‘æ ‡è®°2ä¸ªé‡ç‚¹æˆ¿é—´

            ä½¿ç”¨ä¸­æ–‡é€—å·åˆ†éš”æ•°ç»„é¡¹

            ä¸‹é¢æ˜¯ç”¨æˆ·è¾“å…¥ï¼š

            {{#1746973196324.text#}}'
        selected: false
        title: ç”Ÿæˆæˆ¿é—´æ¦‚è§ˆåˆ—è¡¨
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1746793901295'
      position:
        x: 173.80389727542342
        y: 224.10007990588937
      positionAbsolute:
        x: 173.80389727542342
        y: 224.10007990588937
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: ''
        error_handle_mode: terminated
        height: 235
        is_parallel: true
        iterator_selector:
        - '1746805617115'
        - output
        output_selector:
        - '1746798461643'
        - result
        output_type: array[object]
        parallel_nums: 5
        selected: false
        start_node_id: 1746797398965start
        title: æœå¯»å®¶å…·ä¿¡æ¯
        type: iteration
        width: 808
      height: 235
      id: '1746797398965'
      position:
        x: 2384.4872342583353
        y: 224.10007990588937
      positionAbsolute:
        x: 2384.4872342583353
        y: 224.10007990588937
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 808
      zIndex: 1
    - data:
        desc: ''
        isInIteration: true
        selected: false
        title: ''
        type: iteration-start
      draggable: false
      height: 48
      id: 1746797398965start
      parentId: '1746797398965'
      position:
        x: 24
        y: 68
      positionAbsolute:
        x: 2408.4872342583353
        y: 292.1000799058894
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-iteration-start
      width: 44
      zIndex: 1002
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1746797398965'
        model:
          completion_params:
            max_tokens: 19301
          mode: chat
          name: kimi
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: f2d46e8b-020f-472f-813f-4134f97f2a20
          role: system
          text: 'åŸºäºä»¥ä¸‹è£…ä¿®éœ€æ±‚è¿›è¡Œä¸“ä¸šæœç´¢ï¼š

            æœç´¢åŒ¹é…[æ•´ä½“é£æ ¼]ã€[æˆ¿é—´åç§°]å’Œ[é¡¹ç›®]çš„å»ºæ/å®¶å…·å“ç‰ŒåŠå…·ä½“äº§å“å‹å·

            æŸ¥è¯¢è¯¥äº§å“çš„ç½‘ç»œè¯„ä»·ï¼ˆåŒ…æ‹¬ä¸“ä¸šè¯„æµ‹å’Œæ¶ˆè´¹è€…åé¦ˆï¼‰

            éªŒè¯ç¯ä¿è®¤è¯ä¿¡æ¯ï¼ˆå›½å†…åŠå›½é™…æ ‡å‡†ï¼‰

            æ”¶é›†å¸‚åœºä»·æ ¼èŒƒå›´åŠæ”¶è´¹æ¨¡å¼ï¼ˆå«å®‰è£…è´¹ç”¨ï¼‰

            åˆ—å‡ºæ–½å·¥/ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼ˆéœ€ç»“åˆ[å¤‡æ³¨]è¦æ±‚ï¼‰

            è¾“å…¥å‚æ•°ï¼š

            {

            "æ•´ä½“é£æ ¼": "",

            "æˆ¿é—´åç§°": "",

            "è£…ä¿®é¡¹ç›®": "",

            "å…·ä½“è¦æ±‚": "",

            "é¢„ç®—å‚è€ƒ": "",

            "ç‰¹åˆ«å¤‡æ³¨": ""

            }

            è¦æ±‚ï¼š

            æ¨èè‡³å°‘3ä¸ªç¬¦åˆé¢„ç®—çš„å“ç‰Œæ–¹æ¡ˆ

            åŒºåˆ†è¿›å£/å›½äº§äº§å“

            åŒ…å«ç¯ä¿ç­‰çº§è®¤è¯ä¿¡æ¯

            æ ‡æ³¨çº¿ä¸Š/çº¿ä¸‹è´­ä¹°æ¸ é“å·®å¼‚

            è¾“å‡ºç»“æ„åŒ–JSONæ•°æ®

            === JSONæ¨¡æ¿ ===

            {

            "project_info": {

            "room": "é¤å…",

            "category": "ç¡¬è£…",

            "material_type": "æœ¨åœ°æ¿"

            },

            "recommendations": [

            {

            "brand": "å“ç‰Œåç§°",

            "product_series": "äº§å“ç³»åˆ—",

            "origin": "è¿›å£/å›½äº§",

            "color_code": "#E0E0E0",

            "eco_certification": ["FSCè®¤è¯", "CARB-NAFè®¤è¯"],

            "price_range": {

            "material": "500-800å…ƒ/ã¡",

            "installation": "50-80å…ƒ/ã¡"

            },

            "user_ratings": {

            "average_score": 4.7,

            "review_count": 215,

            "positive_keywords": ["æ— è‰²å·®", "è€ç£¨æ€§å¥½"],

            "negative_keywords": ["å†¬å­£è½»å¾®æ”¶ç¼©"]

            },

            "purchase_channels": [

            {

            "type": "çº¿ä¸Š",

            "platform": ["å¤©çŒ«æ——èˆ°åº—", "äº¬ä¸œè‡ªè¥"],

            "service": "å…è´¹æ ·å“å¯„é€"

            },

            {

            "type": "çº¿ä¸‹",

            "stores": ["å±…ç„¶ä¹‹å®¶", "çº¢æ˜Ÿç¾å‡¯é¾™"],

            "service": "å…è´¹é‡æˆ¿"

            }

            ]

            }

            ],

            "coordination_advice": [

            "å»ºè®®æ­é…åŒç³»åˆ—è¸¢è„šçº¿ä¿æŒæ•´ä½“æ€§",

            "ä¸å®¢å…è¡”æ¥å¤„å»ºè®®ä½¿ç”¨Tå‹å‹æ¡"

            ],

            "precautions": [

            {

            "category": "æ–½å·¥æ³¨æ„",

            "content": "éœ€é¢„ç•™5mmä¼¸ç¼©ç¼"

            },

            {

            "category": "ä¿å…»è¦æ±‚",

            "content": "æ¯æœˆæ‰“èœ¡ä¿å…»"

            }

            ],

            "budget_analysis": {

            "material_cost": "800-1200å…ƒ",

            "total_estimate": "1800-2000å…ƒ",

            "cost_saving_tips": "é€‰æ‹©å“ç‰Œä¿ƒé”€å¥—é¤å¯èŠ‚çœ15%"

            }

            }

            === å…³é”®è¦ç´ è¯´æ˜ ===

            ç¯ä¿ææ–™éªŒè¯ç»´åº¦ï¼š

            å›½å†…æ ‡å‡†ï¼šENF/E0çº§è®¤è¯ã€åç¯è®¤è¯

            å›½é™…æ ‡å‡†ï¼šFSCæ£®æ—è®¤è¯ã€CARB-NAFæ— é†›è®¤è¯

            ä»·æ ¼ç»´åº¦éœ€åŒ…å«ï¼š

            ææ–™å•ä»·

            è¾…æ–™è´¹ç”¨

            å®‰è£…äººå·¥è´¹

            è¿è¾“è´¹

            æ—§æå¤„ç†è´¹

            æ³¨æ„äº‹é¡¹éœ€æ¶µç›–ï¼š

            æ–½å·¥å·¥è‰ºè¦æ±‚

            ä¸å…¶ä»–å»ºæçš„å…¼å®¹æ€§

            å­£èŠ‚æ€§å½±å“

            ä¿ä¿®æ¡æ¬¾

            ç»´æŠ¤å‘¨æœŸå»ºè®®

            ä¸‹é¢æ˜¯è¾“å…¥

            {{#1746797398965.item#}}'
        selected: false
        title: ç”Ÿæˆå•ä¸ªå®¶å…·ç›¸å…³ä¿¡æ¯
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1746797407824'
      parentId: '1746797398965'
      position:
        x: 128
        y: 68
      positionAbsolute:
        x: 2512.4872342583353
        y: 292.1000799058894
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
      zIndex: 1002
    - data:
        code: "import json\nimport re\n\ndef main(text: str) -> dict:\n    # å»é™¤è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„è½¬ä¹‰å­—ç¬¦\n\
          \    text = text.replace('\\\\n', '').replace('\\\\\"', '\"').replace('\\\
          \\\\\\', '\\\\')\n    \n    # ä½¿ç”¨æ­£åˆ™åŒ¹é…æœ€å¤–å±‚çš„{}æ¥ç¡®ä¿è¾“å…¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„JSONå¯¹è±¡\n    pattern\
          \ = r'\\{.*\\}'\n    match = re.search(pattern, text, re.DOTALL)\n    \n\
          \    if not match:\n        return {\"result\": {\"error\": \"No valid JSON\
          \ object found\"}}  # å¦‚æœä¸åŒ¹é…ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯\n    \n    # æå–æœ€å¤–å±‚çš„JSONå¯¹è±¡\n    json_str\
          \ = match.group(0)\n    \n    # å°è¯•è§£æ JSON å­—ç¬¦ä¸²\n    try:\n        data =\
          \ json.loads(json_str)\n        return {\"result\": data}  # è¿”å›è§£æåçš„JSONæ•°æ®\n\
          \    except json.JSONDecodeError as e:\n        return {\"result\": {\"\
          error\": str(e)}}  # å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯"
        code_language: python3
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1746797398965'
        outputs:
          result:
            children: null
            type: object
        selected: false
        title: æ•´ç†å®¶å…·æ ¼å¼
        type: code
        variables:
        - value_selector:
          - '1746797407824'
          - text
          variable: text
      height: 53
      id: '1746798461643'
      parentId: '1746797398965'
      position:
        x: 415.67873395224046
        y: 71.37655397980825
      positionAbsolute:
        x: 2800.1659682105756
        y: 295.47663388569765
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
      zIndex: 1002
    - data:
        code: "import os\nimport json\nimport openpyxl\nimport uuid\nimport mimetypes\n\
          import re\nfrom typing import List, Union, Any, Dict\nfrom openpyxl.styles\
          \ import Alignment\nfrom openpyxl.utils import get_column_letter\n\n\ndef\
          \ save_file_as_dify_format(file_path):\n    \"\"\"\n    å°†ç»™å®šçš„æ–‡ä»¶è·¯å¾„æ‰“åŒ…æˆç¬¦åˆDifyæ ¼å¼çš„æ–‡ä»¶å¯¹è±¡\n\
          \    :param file_path: æ–‡ä»¶çš„å®Œæ•´è·¯å¾„\n    :return: ç¬¦åˆDifyæ ¼å¼çš„æ–‡ä»¶å¯¹è±¡\n    \"\"\"\n\
          \    # ç¡®ä¿æ–‡ä»¶å­˜åœ¨\n    if not os.path.exists(file_path):\n        raise FileNotFoundError(f\"\
          æ–‡ä»¶ {file_path} ä¸å­˜åœ¨\")\n\n    # è·å–æ–‡ä»¶åã€æ‰©å±•åã€å¤§å°å’ŒMIMEç±»å‹\n    file_name = os.path.basename(file_path)\n\
          \    file_size = os.path.getsize(file_path)\n    _, file_extension = os.path.splitext(file_name)\n\
          \    mime_type = mimetypes.guess_type(file_path)[0] or \"application/octet-stream\"\
          \n\n    # æ„å»ºDifyæ ¼å¼çš„æ–‡ä»¶å¯¹è±¡\n    file_output = {\n        \"dify_model_identity\"\
          : \"__dify__file__\",\n        \"id\": None,\n        \"tenant_id\": \"\"\
          ,\n        \"type\": \"document\" if mime_type.startswith(\"application\"\
          ) else \"image\" if mime_type.startswith(\"image\") else \"other\",\n  \
          \      \"transfer_method\": \"local_file\",\n        \"remote_url\": \"\"\
          ,\n        \"related_id\": str(uuid.uuid4()),\n        \"filename\": file_name,\n\
          \        \"name\": file_name,\n        \"extension\": file_extension,\n\
          \        \"mime_type\": mime_type,\n        \"size\": file_size,\n     \
          \   \"url\": f\"/tmp/workflows/{file_name}\"\n    }\n\n    return {\"file_output\"\
          : file_output}\n\ndef flatten_json(data, parent_key='', sep='_'):\n    \"\
          \"\"\n    å°†åµŒå¥—çš„JSONæ•°æ®å±•å¹³ä¸ºå•å±‚å­—å…¸\n    :param data: JSONæ•°æ®\n    :param parent_key:\
          \ çˆ¶çº§é”®\n    :param sep: åˆ†éš”ç¬¦\n    :return: å±•å¹³åçš„å­—å…¸\n    \"\"\"\n    items =\
          \ []\n    if isinstance(data, dict):\n        for k, v in data.items():\n\
          \            # å…³é”®ä¿®æ”¹ï¼šè·³è¿‡åŒ…å« error çš„é”®ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰\n            if 'error' in k.lower():\n\
          \                continue\n            new_key = f\"{parent_key}{sep}{k}\"\
          \ if parent_key else k\n            items.extend(flatten_json(v, new_key,\
          \ sep).items())\n    elif isinstance(data, list):\n        for i, v in enumerate(data):\n\
          \            new_key = f\"{parent_key}{sep}{i}\" if parent_key else str(i)\n\
          \            items.extend(flatten_json(v, new_key, sep).items())\n    else:\n\
          \        items.append((parent_key, data))\n    return dict(items)\n\n\n\
          def deep_filter_errors(data: Any) -> Any:\n    \"\"\"\n    é€’å½’è¿‡æ»¤æ‰€æœ‰åŒ…å«é”™è¯¯ä¿¡æ¯çš„ç»“æ„\n\
          \    æ–°å¢ï¼šè¿‡æ»¤ Expecting ',' delimiter é”™è¯¯æ¨¡å¼\n    \"\"\"\n    # å®šä¹‰ç»Ÿä¸€é”™è¯¯åŒ¹é…æ¨¡å¼ï¼ˆåŒæ—¶åŒ¹é…ä¸¤ç§é”™è¯¯ï¼‰\n\
          \    error_pattern = re.compile(\n        r'('\n        r'\\\"error\\\"\\\
          s*:\\s*(\".*?\"|\\d+|true|false|null|\\[.*?\\]|\\{.*?\\})'  # åŸé”™è¯¯æ¨¡å¼\n  \
          \      r'|'  # é€»è¾‘æˆ–\n        r'Expecting \\',\\' delimiter: line \\d+ column\
          \ \\d+ \\(char \\d+\\)'  # æ–°å¢é”™è¯¯æ¨¡å¼\n        r')',\n        re.DOTALL | re.IGNORECASE\n\
          \    )\n\n    # å¤„ç†å­—å…¸ç±»å‹\n    if isinstance(data, dict):\n        filtered_dict\
          \ = {}\n        for k, v in data.items():\n            # æ–°å¢ï¼šæ£€æŸ¥é”®å€¼å¯¹æ˜¯å¦åŒ…å«é”™è¯¯æè¿°\n\
          \            if error_pattern.search(f'\"{k}\":{json.dumps(v)}'):\n    \
          \            continue\n            # åŸè¿‡æ»¤é€»è¾‘...\n            filtered_value\
          \ = deep_filter_errors(v)\n            if filtered_value is not None:\n\
          \                filtered_dict[k] = filtered_value\n        return filtered_dict\
          \ if filtered_dict else None\n\n    # å¤„ç†åˆ—è¡¨ç±»å‹\n    elif isinstance(data,\
          \ list):\n        filtered_list = []\n        for item in data:\n      \
          \      # æ–°å¢ï¼šç›´æ¥è¿‡æ»¤åˆ—è¡¨ä¸­çš„é”™è¯¯å­—ç¬¦ä¸²\n            if isinstance(item, str) and error_pattern.search(item):\n\
          \                continue\n            # åŸè¿‡æ»¤é€»è¾‘...\n            filtered_item\
          \ = deep_filter_errors(item)\n            if filtered_item is not None:\n\
          \                filtered_list.append(filtered_item)\n        return filtered_list\n\
          \n    # å¤„ç†å­—ç¬¦ä¸²ç±»å‹ï¼ˆå…³é”®ä¿®æ”¹éƒ¨åˆ†ï¼‰\n    elif isinstance(data, str):\n        # åŒæ—¶æ¸…ç†ä¸¤ç§é”™è¯¯æ¨¡å¼\n\
          \        cleaned_str = error_pattern.sub('', data)\n\n        # æ–°å¢ï¼šé¢å¤–è¿‡æ»¤çº¯é”™è¯¯è¡Œ\n\
          \        line_error_pattern = re.compile(\n            r'^\\s*Expecting\
          \ \\',\\' delimiter: line \\d+ column \\d+ \\(char \\d+\\)\\s*$',\n    \
          \        re.IGNORECASE\n        )\n        if line_error_pattern.match(data.strip()):\n\
          \            return None\n\n        return cleaned_str.strip() if cleaned_str.strip()\
          \ else None\n\n    # å…¶ä»–ç±»å‹ä¿ç•™\n    else:\n        return data\n\ndef filter_error_entries(data:\
          \ List[Union[Dict, List, str]]) -> List[Union[Dict, List, str]]:\n    \"\
          \"\"\n    ä¸»è¿‡æ»¤å‡½æ•°\n    \"\"\"\n    filtered = []\n    for entry in data:\n\
          \        processed = deep_filter_errors(entry)\n        if processed is\
          \ not None:  # è·³è¿‡å®Œå…¨è¢«è¿‡æ»¤çš„æ¡ç›®\n            filtered.append(processed)\n    return\
          \ filtered\n\ndef create_excel_from_json(data, save_directory, file_name):\n\
          \    \"\"\"\n    æ ¹æ®JSONæ•°æ®åˆ›å»ºExcelæ–‡ä»¶\n    :param data: JSONæ•°æ®ï¼ˆåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå­—å…¸ï¼‰\n\
          \    :param save_directory: ä¿å­˜ç›®å½•\n    :param file_name: æ–‡ä»¶å\n    :return:\
          \ ç”Ÿæˆçš„Excelæ–‡ä»¶è·¯å¾„\n    \"\"\"\n    # åˆ›å»ºå·¥ä½œç°¿\n    workbook = openpyxl.Workbook()\n\
          \    sheet = workbook.active\n    sheet.title = \"æ•°æ®è¡¨\"\n\n    # å¦‚æœæ•°æ®æ˜¯ç©ºçš„ï¼Œç›´æ¥è¿”å›\n\
          \    if not data:\n        raise ValueError(\"è¾“å…¥çš„JSONæ•°æ®ä¸ºç©º\")\n\n    # å±•å¹³æ¯ä¸ªJSONå¯¹è±¡\n\
          \    flat_data_list = [flatten_json(item) for item in data]\n\n    # è·å–æ‰€æœ‰å¯èƒ½çš„è¡¨å¤´\n\
          \    headers = set()\n    for flat_data in flat_data_list:\n        headers.update(flat_data.keys())\n\
          \    headers = sorted(headers)\n\n    # å…³é”®ä¿®æ”¹ï¼šè¿‡æ»¤åŒ…å«errorçš„åˆ—åï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰\n    filtered_headers\
          \ = [\n        header for header in sorted(headers)\n        if \"error\"\
          \ not in header.lower()  # è¿‡æ»¤æ¡ä»¶\n    ]\n\n    # â­ è¿›ä¸€æ­¥éªŒè¯ï¼šç¡®ä¿ filtered_headers\
          \ ä¸­ä¸åŒ…å«ä»»ä½•åŒ…å« \"error\" çš„é”®\n    for header in filtered_headers:\n        if\
          \ \"error\" in header.lower():\n            print(f\"è­¦å‘Šï¼šå‘ç°æœªè¢«è¿‡æ»¤çš„ error è¡¨å¤´\
          \ - {header}\")\n\n    # â­ æ·»åŠ ä¸­è‹±æ–‡è¡¨å¤´æ˜ å°„ï¼ˆç¤ºä¾‹æ˜ å°„ï¼Œå¯æŒ‰éœ€æ‰©å±•ï¼‰\n    header_translations\
          \ = {\n        # ç¤ºä¾‹å­—æ®µæ˜ å°„\n        \"budget_analysis_cost_saving_tips\": \"\
          é¢„ç®—èŠ‚çœæé†’\",\n        \"budget_analysis_material_cost\": \"åŸæ–™é¢„ç®—èŒƒå›´\",\n    \
          \    \"budget_analysis_total_estimate\": \"æ€»ä½“é¢„ç®—\",\n        \"coordination_advice_0\"\
          : \"æ­é…å»ºè®®ä¸€\",\n        \"coordination_advice_1\": \"æ­é…å»ºè®®äºŒ\",\n        \"\
          coordination_advice_2\": \"æ­é…å»ºè®®ä¸‰\",\n        #\"error\":\"é”™è¯¯\",\n      \
          \  \"precautions_0_category\":\"æ–½å·¥ç›®å½•\",\n        \"precautions_0_content\"\
          :\"æ–½å·¥æ³¨æ„äº‹é¡¹\",\n        \"precautions_1_category\":\"ä¿å…»ç›®å½•ä¸€\",\n        \"\
          precautions_1_content\":\"ä¿å…»æ³¨æ„äº‹é¡¹ä¸€\",\n        \"precautions_2_category\"\
          : \"ä¿å…»ç›®å½•äºŒ\",\n        \"precautions_2_content\": \"ä¿å…»æ³¨æ„äº‹é¡¹äºŒ\",\n        \"\
          precautions_3_category\": \"ä¿å…»ç›®å½•ä¸‰\",\n        \"precautions_3_content\"\
          : \"ä¿å…»æ³¨æ„äº‹é¡¹ä¸‰\",\n        \"precautions_3_category\": \"ä¿å…»ç›®å½•å››\",\n       \
          \ \"precautions_3_content\": \"ä¿å…»æ³¨æ„äº‹é¡¹å››\",\n        \"project_info_category\"\
          : \"å®¶å…·åç§°\",\n        \"project_info_material_type\": \"å®¶å…·åŸææ–™\",\n      \
          \  \"project_info_room\": \"å®¶å…·æ‰€åœ¨æˆ¿é—´\",\n\n        \"recommendations_0_brand\"\
          : \"å®¶å…·å“ç‰Œä¸€\",\n        \"recommendations_0_color_code\": \"å®¶å…·é¢œè‰²ä»£ç ä¸€\",\n \
          \       \"recommendations_0_color_code_0\": \"å®¶å…·é¢œè‰²ä»£ç äºŒ\",\n        \"recommendations_0_color_code_1\"\
          : \"å®¶å…·é¢œè‰²ä»£ç ä¸‰\",\n        \"recommendations_0_color_code_2\": \"å®¶å…·é¢œè‰²ä»£ç å››\"\
          ,\n        \"recommendations_0_color_code_inner\": \"å®¶å…·å†…éƒ¨é¢œè‰²ä»£ç \",\n     \
          \   \"recommendations_0_color_code_outer\": \"å®¶å…·å¤–éƒ¨é¢œè‰²ä»£ç \",\n        \"recommendations_0_color_code_frame\"\
          : \"æ¡†æ¶é¢œè‰²\",\n        \"recommendations_0_color_code_glass\": \"ç»ç’ƒé¢œè‰²\",\n\
          \        \"recommendations_0_eco_certification_0\": \"å®¶å…·ç¯ä¿è®¤è¯ä¸€\",\n     \
          \   \"recommendations_0_eco_certification_1\": \"å®¶å…·ç¯ä¿è®¤è¯äºŒ\",\n        \"\
          recommendations_0_eco_certification_2\": \"å®¶å…·ç¯ä¿è®¤è¯ä¸‰\",\n        \"recommendations_0_origin\"\
          : \"å®¶å…·å“ç‰Œå‡ºäº§åœ°\",\n        \"recommendations_0_price_range_auxiliary_materials\"\
          : \"å•ä½é¢ç§¯ä»·æ ¼\",\n        \"recommendations_0_price_range_bookshelf\": \"ä¹¦æ¶ä»·æ ¼èŒƒå›´\"\
          ,\n        \"recommendations_0_price_range_installation\": \"å®‰è£…ä»·æ ¼å•ä½é¢ç§¯ä»·æ ¼\"\
          ,\n        \"recommendations_0_price_range_installation_ä¹³èƒ¶æ¼†\": \"ä¹³èƒ¶å®‰è£…ä»·æ ¼\"\
          ,\n        \"recommendations_0_price_range_installation_æœ¨è´¨è½¯åŒ…\": \"æœ¨è´¨è½¯åŒ…å®‰è£…ä»·æ ¼\"\
          ,\n        \"recommendations_0_price_range_material\": \"æ€»ä½“è£…ä¿®ä»·æ ¼\",\n   \
          \     \"recommendations_0_price_range_material_ä¹³èƒ¶æ¼†\": \"ä¹³èƒ¶æ¼†åŸæ–™ä»·æ ¼\",\n   \
          \     \"recommendations_0_price_range_material_æœ¨è´¨è½¯åŒ…\": \"æœ¨è´¨è½¯åŒ…åŸæ–™ä»·æ ¼\",\n \
          \       \"recommendations_0_price_range_old_material_disposal\": \"æ—§ææ–™å¤„ç†çš„ä»·æ ¼èŒƒå›´å»ºè®®\"\
          ,\n        \"recommendations_0_price_range_single_bed\": \"å•ä¸ªåºŠçš„ä»·æ ¼\",\n \
          \       \"recommendations_0_price_range_transportation\": \"è¿è¾“è´¹\",\n   \
          \     \"recommendations_0_product_series\": \"äº§å“ç³»åˆ—\",\n        \"recommendations_0_purchase_channels_0_platform_0\"\
          : \"ç¬¬ä¸€ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_0_purchase_channels_0_platform_1\"\
          : \"ç¬¬äºŒä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_0_purchase_channels_0_service\"\
          : \"è´­ä¹°æ¸ é“æä¾›çš„æœåŠ¡ä¸€\",\n        \"recommendations_0_purchase_channels_0_type\"\
          : \"è´­ä¹°æ¸ é“ç§ç±»\",\n        \"recommendations_0_purchase_channels_1_service\"\
          : \"è´­ä¹°æ¸ é“æä¾›çš„æœåŠ¡äºŒ\",\n        \"recommendations_0_purchase_channels_1_stores_0\"\
          : \"ç¬¬ä¸‰ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_0_purchase_channels_1_stores_1\"\
          : \"ç¬¬å››ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_0_purchase_channels_1_stores_2\"\
          : \"ç¬¬äº”ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_0_purchase_channels_1_type\":\
          \ \"è´­ä¹°æ¸ é“ç§ç±»\",\n        \"recommendations_0_user_ratings_average_score\"\
          : \"ä½¿ç”¨ç”¨æˆ·å¹³å‡è¯„åˆ†\",\n        \"recommendations_0_user_ratings_negative_keywords_0\"\
          : \"ç”¨æˆ·å·®è¯„å…³é”®è¯ä¸€\",\n        \"recommendations_0_user_ratings_positive_keywords_0\"\
          : \"ç”¨æˆ·å¥½è¯„å…³é”®è¯ä¸€\",\n        \"recommendations_0_user_ratings_positive_keywords_1\"\
          : \"ç”¨æˆ·å¥½è¯„å…³é”®è¯äºŒ\",\n        \"recommendations_0_user_ratings_positive_keywords_2\"\
          : \"ç”¨æˆ·å·®è¯„å…³é”®è¯ä¸‰\",\n        \"recommendations_0_user_ratings_review_count\"\
          : \"ç”¨æˆ·è¯„è®ºæ•°\",\n\n        \"recommendations_1_brand\": \"å®¶å…·å“ç‰ŒäºŒ\",\n      \
          \  \"recommendations_1_color_code\": \"å®¶å…·é¢œè‰²ä»£ç ä¸€\",\n        \"recommendations_1_color_code_0\"\
          : \"å®¶å…·é¢œè‰²ä»£ç äºŒ\",\n        \"recommendations_1_color_code_1\": \"å®¶å…·é¢œè‰²ä»£ç ä¸‰\"\
          ,\n        \"recommendations_1_color_code_2\": \"å®¶å…·é¢œè‰²ä»£ç å››\",\n        \"\
          recommendations_1_color_code_inner\": \"å®¶å…·å†…éƒ¨é¢œè‰²ä»£ç \",\n        \"recommendations_1_color_code_outer\"\
          : \"å®¶å…·å¤–éƒ¨é¢œè‰²ä»£ç \",\n        \"recommendations_1_color_code_frame\":\"æ¡†æ¶é¢œè‰²\"\
          ,\n        \"recommendations_1  _color_code_glass\": \"ç»ç’ƒé¢œè‰²\",\n       \
          \ \"recommendations_1_eco_certification_0\": \"å®¶å…·ç¯ä¿è®¤è¯ä¸€\",\n        \"recommendations_1_eco_certification_1\"\
          : \"å®¶å…·ç¯ä¿è®¤è¯äºŒ\",\n        \"recommendations_1_eco_certification_2\": \"å®¶å…·ç¯ä¿è®¤è¯ä¸‰\"\
          ,\n        \"recommendations_1_origin\": \"å®¶å…·å“ç‰Œå‡ºäº§åœ°\",\n        \"recommendations_1_price_range_auxiliary_materials\"\
          : \"å•ä½é¢ç§¯ä»·æ ¼\",\n        \"recommendations_1_price_range_bookshelf\": \"ä¹¦æ¶ä»·æ ¼èŒƒå›´\"\
          ,\n        \"recommendations_1_price_range_installation\": \"å®‰è£…ä»·æ ¼å•ä½é¢ç§¯ä»·æ ¼\"\
          ,\n        \"recommendations_1_price_range_installation_ä¹³èƒ¶æ¼†\": \"ä¹³èƒ¶å®‰è£…ä»·æ ¼\"\
          ,\n        \"recommendations_1_price_range_installation_æœ¨è´¨è½¯åŒ…\": \"æœ¨è´¨è½¯åŒ…å®‰è£…ä»·æ ¼\"\
          ,\n        \"recommendations_1_price_range_material\": \"æ€»ä½“è£…ä¿®ä»·æ ¼\",\n   \
          \     \"recommendations_1_price_range_material_ä¹³èƒ¶æ¼†\": \"ä¹³èƒ¶æ¼†åŸæ–™ä»·æ ¼\",\n   \
          \     \"recommendations_1_price_range_material_æœ¨è´¨è½¯åŒ…\": \"æœ¨è´¨è½¯åŒ…åŸæ–™ä»·æ ¼\",\n \
          \       \"recommendations_1_price_range_old_material_disposal\": \"æ—§ææ–™å¤„ç†çš„ä»·æ ¼èŒƒå›´å»ºè®®\"\
          ,\n        \"recommendations_1_price_range_single_bed\": \"å•ä¸ªåºŠçš„ä»·æ ¼\",\n \
          \       \"recommendations_1_price_range_transportation\": \"è¿è¾“è´¹\",\n   \
          \     \"recommendations_1_product_series\": \"äº§å“ç³»åˆ—\",\n        \"recommendations_1_purchase_channels_0_platform_0\"\
          : \"ç¬¬ä¸€ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_1_purchase_channels_0_platform_1\"\
          : \"ç¬¬äºŒä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_1_purchase_channels_0_service\"\
          : \"è´­ä¹°æ¸ é“æä¾›çš„æœåŠ¡ä¸€\",\n        \"recommendations_1_purchase_channels_0_type\"\
          : \"è´­ä¹°æ¸ é“ç§ç±»\",\n        \"recommendations_1_purchase_channels_1_service\"\
          : \"è´­ä¹°æ¸ é“æä¾›çš„æœåŠ¡äºŒ\",\n        \"recommendations_1_purchase_channels_1_stores_0\"\
          : \"ç¬¬ä¸‰ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_1_purchase_channels_1_stores_1\"\
          : \"ç¬¬å››ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_1_purchase_channels_1_stores_2\"\
          : \"ç¬¬äº”ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_1_purchase_channels_1_type\":\
          \ \"è´­ä¹°æ¸ é“ç§ç±»\",\n        \"recommendations_1_user_ratings_average_score\"\
          : \"ä½¿ç”¨ç”¨æˆ·å¹³å‡è¯„åˆ†\",\n        \"recommendations_1_user_ratings_negative_keywords_0\"\
          : \"ç”¨æˆ·å·®è¯„å…³é”®è¯ä¸€\",\n        \"recommendations_1_user_ratings_positive_keywords_0\"\
          : \"ç”¨æˆ·å¥½è¯„å…³é”®è¯ä¸€\",\n        \"recommendations_1_user_ratings_positive_keywords_1\"\
          : \"ç”¨æˆ·å¥½è¯„å…³é”®è¯äºŒ\",\n        \"recommendations_1_user_ratings_positive_keywords_2\"\
          : \"ç”¨æˆ·å·®è¯„å…³é”®è¯ä¸‰\",\n        \"recommendations_1_user_ratings_review_count\"\
          : \"ç”¨æˆ·è¯„è®ºæ•°\",\n\n        \"recommendations_2_brand\": \"å®¶å…·å“ç‰Œä¸‰\",\n      \
          \  \"recommendations_2_color_code\": \"å®¶å…·é¢œè‰²ä»£ç ä¸€\",\n        \"recommendations_2_color_code_0\"\
          : \"å®¶å…·é¢œè‰²ä»£ç äºŒ\",\n        \"recommendations_2_color_code_1\": \"å®¶å…·é¢œè‰²ä»£ç ä¸‰\"\
          ,\n        \"recommendations_2_color_code_2\": \"å®¶å…·é¢œè‰²ä»£ç å››\",\n        \"\
          recommendations_2_color_code_inner\": \"å®¶å…·å†…éƒ¨é¢œè‰²ä»£ç \",\n        \"recommendations_2_color_code_outer\"\
          : \"å®¶å…·å¤–éƒ¨é¢œè‰²ä»£ç \",\n        \"recommendations_2_eco_certification_0\": \"å®¶å…·ç¯ä¿è®¤è¯ä¸€\"\
          ,\n        \"recommendations_2_eco_certification_1\": \"å®¶å…·ç¯ä¿è®¤è¯äºŒ\",\n   \
          \     \"recommendations_2_eco_certification_2\": \"å®¶å…·ç¯ä¿è®¤è¯ä¸‰\",\n        \"\
          recommendations_2_origin\": \"å®¶å…·å“ç‰Œå‡ºäº§åœ°\",\n        \"recommendations_2_price_range_auxiliary_materials\"\
          : \"å•ä½é¢ç§¯ä»·æ ¼\",\n        \"recommendations_2_price_range_bookshelf\": \"ä¹¦æ¶ä»·æ ¼èŒƒå›´\"\
          ,\n        \"recommendations_2_price_range_installation\": \"å®‰è£…ä»·æ ¼å•ä½é¢ç§¯ä»·æ ¼\"\
          ,\n        \"recommendations_2_price_range_installation_ä¹³èƒ¶æ¼†\": \"ä¹³èƒ¶å®‰è£…ä»·æ ¼\"\
          ,\n        \"recommendations_2_price_range_installation_æœ¨è´¨è½¯åŒ…\": \"æœ¨è´¨è½¯åŒ…å®‰è£…ä»·æ ¼\"\
          ,\n        \"recommendations_2_price_range_material\": \"æ€»ä½“è£…ä¿®ä»·æ ¼\",\n   \
          \     \"recommendations_2_price_range_material_ä¹³èƒ¶æ¼†\": \"ä¹³èƒ¶æ¼†åŸæ–™ä»·æ ¼\",\n   \
          \     \"recommendations_2_price_range_material_æœ¨è´¨è½¯åŒ…\": \"æœ¨è´¨è½¯åŒ…åŸæ–™ä»·æ ¼\",\n \
          \       \"recommendations_2_price_range_old_material_disposal\": \"æ—§ææ–™å¤„ç†çš„ä»·æ ¼èŒƒå›´å»ºè®®\"\
          ,\n        \"recommendations_2_price_range_single_bed\": \"å•ä¸ªåºŠçš„ä»·æ ¼\",\n \
          \       \"recommendations_2_price_range_transportation\": \"è¿è¾“è´¹\",\n   \
          \     \"recommendations_2_product_series\": \"äº§å“ç³»åˆ—\",\n        \"recommendations_2_purchase_channels_0_platform_0\"\
          : \"ç¬¬ä¸€ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_2_purchase_channels_0_platform_1\"\
          : \"ç¬¬äºŒä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_2_purchase_channels_0_service\"\
          : \"è´­ä¹°æ¸ é“æä¾›çš„æœåŠ¡ä¸€\",\n        \"recommendations_2_purchase_channels_0_type\"\
          : \"è´­ä¹°æ¸ é“ç§ç±»\",\n        \"recommendations_2_purchase_channels_1_service\"\
          : \"è´­ä¹°æ¸ é“æä¾›çš„æœåŠ¡äºŒ\",\n        \"recommendations_2_purchase_channels_1_stores_0\"\
          : \"ç¬¬ä¸‰ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_2_purchase_channels_1_stores_1\"\
          : \"ç¬¬å››ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_2_purchase_channels_1_stores_2\"\
          : \"ç¬¬äº”ä¸ªè´­ä¹°æ¸ é“\",\n        \"recommendations_2_purchase_channels_1_type\":\
          \ \"è´­ä¹°æ¸ é“ç§ç±»\",\n        \"recommendations_2_user_ratings_average_score\"\
          : \"ä½¿ç”¨ç”¨æˆ·å¹³å‡è¯„åˆ†\",\n        \"recommendations_2_user_ratings_negative_keywords_0\"\
          : \"ç”¨æˆ·å·®è¯„å…³é”®è¯ä¸€\",\n        \"recommendations_2_user_ratings_positive_keywords_0\"\
          : \"ç”¨æˆ·å¥½è¯„å…³é”®è¯ä¸€\",\n        \"recommendations_2_user_ratings_positive_keywords_1\"\
          : \"ç”¨æˆ·å¥½è¯„å…³é”®è¯äºŒ\",\n        \"recommendations_2_user_ratings_positive_keywords_2\"\
          : \"ç”¨æˆ·å·®è¯„å…³é”®è¯ä¸‰\",\n        \"recommendations_2_user_ratings_review_count\"\
          : \"ç”¨æˆ·è¯„è®ºæ•°\"\n\n        # è¯·åœ¨æ­¤å¤„ç»§ç»­è¡¥å……æ‚¨çš„å­—æ®µç¿»è¯‘...\n    }\n\n    # â­ ç¿»è¯‘è¡¨å¤´\n    translated_headers\
          \ = [header_translations.get(h, h) for h in filtered_headers]  # æœªæ˜ å°„çš„å­—æ®µä¿æŒåŸæ ·\n\
          \n    # å†™å…¥è¡¨å¤´\n    sheet.append(translated_headers)\n\n    # è®¾ç½®è¡¨å¤´å±…ä¸­ä¸”ä¸æ¢è¡Œ\n\
          \    for col_idx, cell in enumerate(sheet[1], 1):\n        # ä¸­æ–‡å­—ç¬¦å®½åº¦è®¡ç®—ï¼ˆç›´æ¥å†…è”å¤„ç†ï¼‰\n\
          \        header_text = str(cell.value)\n        adjusted_length = 0\n  \
          \      for char in header_text:\n            if '\\u4e00' <= char <= '\\\
          u9fff' or '\\u3000' <= char <= '\\u303f':  # ä¸­æ—¥éŸ©å­—ç¬¦åŠä¸­æ–‡æ ‡ç‚¹\n              \
          \  adjusted_length += 2.2  # æ¯ä¸ªä¸­æ–‡å­—ç¬¦æŒ‰2.2ä¸ªè‹±æ–‡å­—ç¬¦å®½åº¦è®¡ç®—\n            else:\n  \
          \              adjusted_length += 1\n\n        # è®¾ç½®åˆ—å®½åˆå§‹å€¼ï¼ˆè¡¨å¤´é•¿åº¦*1.3 + ç¼“å†²ï¼‰\n\
          \        sheet.column_dimensions[get_column_letter(col_idx)].width = adjusted_length\
          \ * 1.3 + 3\n\n        # è®¾ç½®å±…ä¸­æ ·å¼\n        cell.alignment = Alignment(\n \
          \           horizontal='center',\n            vertical='center',\n     \
          \       wrap_text=False\n        )\n\n    # å†™å…¥æ•°æ®\n    for flat_data in flat_data_list:\n\
          \        row = [flat_data.get(header, \"\") for header in filtered_headers]\n\
          \        sheet.append(row)\n\n    # è®¾ç½®æ•°æ®è¡Œæ¢è¡Œ\n    for row in sheet.iter_rows(min_row=2):\n\
          \        for cell in row:\n            cell.alignment = Alignment(wrap_text=True)\n\
          \n    # è°ƒæ•´åˆ—å®½ï¼ˆæ•´åˆä¸­æ–‡å¤„ç†ï¼‰\n    for column in sheet.columns:\n        col_letter\
          \ = column[0].column_letter\n        max_length = 0\n\n        # å¤„ç†è¡¨å¤´ï¼ˆå·²ç»è®¾ç½®è¿‡ï¼Œè¿™é‡Œåªéœ€è¦å–å½“å‰å€¼ï¼‰\n\
          \        header_cell = column[0]\n        current_width = sheet.column_dimensions[col_letter].width\n\
          \n        # è®¡ç®—æ•°æ®è¡Œæœ€å¤§é•¿åº¦ï¼ˆå¸¦ä¸­æ–‡å¤„ç†ï¼‰\n        for cell in column[1:]:\n        \
          \    if cell.value:\n                cell_length = 0\n                for\
          \ line in str(cell.value).split('\\n'):\n                    line_length\
          \ = 0\n                    for char in line:\n                        if\
          \ '\\u4e00' <= char <= '\\u9fff' or '\\u3000' <= char <= '\\u303f':\n  \
          \                          line_length += 2.2\n                        else:\n\
          \                            line_length += 1\n                    if line_length\
          \ > max_length:\n                        max_length = line_length\n\n  \
          \      # æœ€ç»ˆåˆ—å®½å–è¡¨å¤´å’Œæ•°æ®æœ€å¤§å€¼\n        final_width = max(current_width, max_length\
          \ * 1.1 + 2)  # æ•°æ®è¡Œå¢åŠ 10%ä½™é‡\n        sheet.column_dimensions[col_letter].width\
          \ = min(final_width, 50)  # é™åˆ¶æœ€å¤§å®½åº¦\n\n    # è°ƒæ•´è¡Œé«˜ï¼ˆå¦‚æœæœ‰æ¢è¡Œå†…å®¹ï¼‰\n    for row in\
          \ sheet.iter_rows():\n        max_height = 12.5  # é»˜è®¤è¡Œé«˜ï¼ˆExcelçš„é»˜è®¤è¡Œé«˜ä¸º12.5ï¼‰\n\
          \        for cell in row:\n            # åˆ¤æ–­å•å…ƒæ ¼æ˜¯å¦æœ‰æ¢è¡Œ\n            if cell.value\
          \ and isinstance(cell.value, str) and '\\n' in cell.value:\n           \
          \     lines = cell.value.count('\\n') + 1  # è®¡ç®—è¡Œæ•°\n                row_height\
          \ = 12.5 * lines  # æ¯è¡Œé«˜åº¦ä¸º12.5\n                if row_height > max_height:\n\
          \                    max_height = row_height\n        if max_height > 12.5:\n\
          \            sheet.row_dimensions[row[0].row].height = max_height\n\n  \
          \  # ç¡®ä¿ä¿å­˜ç›®å½•å­˜åœ¨\n    if not os.path.exists(save_directory):\n        os.makedirs(save_directory)\n\
          \n    # ä¿å­˜æ–‡ä»¶\n    output_file = os.path.join(save_directory, file_name)\n\
          \    workbook.save(output_file)\n    return output_file\n\ndef main(json_array):\n\
          \    \"\"\"\n    ä¸»å‡½æ•°ï¼Œå¤„ç†JSONæ•°ç»„ï¼Œåˆ›å»ºExcelæ–‡ä»¶ï¼Œå¹¶è¿”å›Difyæ ¼å¼çš„æ–‡ä»¶å¯¹è±¡\n    :param json_array:\
          \ è¾“å…¥çš„JSONæ•°ç»„ï¼ˆåˆ—è¡¨ï¼‰\n    :return: ç¬¦åˆDifyæ ¼å¼çš„æ–‡ä»¶å¯¹è±¡\n    \"\"\"\n    # è¿‡æ»¤æ•°æ® -> ç”ŸæˆExcel\
          \ -> æ‰“åŒ…æ–‡ä»¶\n    filtered_data = filter_error_entries(json_array)\n\n    #\
          \ æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºåˆ—è¡¨\n    if not isinstance(json_array, list):\n        raise TypeError(\"\
          è¾“å…¥çš„JSONæ•°æ®å¿…é¡»æ˜¯åˆ—è¡¨\")\n\n    # å®šä¹‰ä¿å­˜è·¯å¾„å’Œæ–‡ä»¶å\n    save_directory = \"/var/sandbox/sandbox-python/usr/local/storage/workflows/\"\
          \n    file_name = \"output.xlsx\"\n\n    # åˆ›å»ºExcelæ–‡ä»¶\n    excel_file_path\
          \ = create_excel_from_json(json_array, save_directory, file_name)\n\n  \
          \  # è¿”å›Difyæ ¼å¼çš„æ–‡ä»¶å¯¹è±¡\n    return save_file_as_dify_format(excel_file_path)"
        code_language: python3
        desc: ''
        outputs:
          file_output:
            children: null
            type: file
        selected: false
        title: æ•´ç†å¹¶ç”ŸæˆExcel
        type: code
        variables:
        - value_selector:
          - '1746797398965'
          - output
          variable: json_array
      height: 53
      id: '1746803669588'
      position:
        x: 3518.0437154428323
        y: 281.6106012786461
      positionAbsolute:
        x: 3518.0437154428323
        y: 281.6106012786461
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1746803669588'
          - file_output
          variable: file_output
        selected: false
        title: ç»“æŸ
        type: end
      height: 89
      id: '1746804995053'
      position:
        x: 4036.4569079943326
        y: 365.974691616081
      positionAbsolute:
        x: 4036.4569079943326
        y: 365.974691616081
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: ''
        error_handle_mode: terminated
        height: 281
        is_parallel: true
        iterator_selector:
        - '1746806049812'
        - rooms
        output_selector:
        - '1746806259993'
        - result
        output_type: array[object]
        parallel_nums: 5
        selected: false
        start_node_id: 1746805617115start
        title: æœå¯»æˆ¿é—´ä¿¡æ¯
        type: iteration
        width: 899
      height: 281
      id: '1746805617115'
      position:
        x: 1092.4782246118612
        y: 144.171598935898
      positionAbsolute:
        x: 1092.4782246118612
        y: 144.171598935898
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 899
      zIndex: 1
    - data:
        desc: ''
        isInIteration: true
        selected: false
        title: ''
        type: iteration-start
      draggable: false
      height: 48
      id: 1746805617115start
      parentId: '1746805617115'
      position:
        x: 24
        y: 68
      positionAbsolute:
        x: 1116.4782246118612
        y: 212.171598935898
      selectable: false
      sourcePosition: right
      targetPosition: left
      type: custom-iteration-start
      width: 44
      zIndex: 1002
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1746805617115'
        model:
          completion_params: {}
          mode: chat
          name: kimi
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: eeb022a0-a2b7-45e2-81d6-5f04d95080e1
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šå®¤å†…è®¾è®¡å¸ˆï¼Œæ ¹æ®æ¦‚è§ˆä¿¡æ¯ç”Ÿæˆå•ä¸ªæˆ¿é—´çš„è¯¦ç»†æ–¹æ¡ˆã€‚è¯·ä¸¥æ ¼éµå¾ªï¼š\nç”¨æ ‡å‡†JSONæ ¼å¼ï¼Œç»“æ„å¦‚ä¸‹ï¼š\n{\n  \"overall_style\"\
            : \"é£æ ¼åç§°\",\n  \"rooms\": [\n    {\n      \"name\": \"æˆ¿é—´åç§°\",\n      \"\
            hardware\": [\n        {\"item\":\"é¡¹ç›®å\", \"desc\":\"æè´¨/é¢œè‰²/å·¥è‰ºç»†èŠ‚/é¢„ç®—\",\
            \ \"note\":\"å¯é€‰æŠ€æœ¯è¯´æ˜\"}\n      ],\n      \"software\": [\n        {\"item\"\
            :\"ç‰©å“å\", \"desc\":\"å°ºå¯¸/æ¬¾å¼/å¯é€‰æ™ºèƒ½å®¶å±…/é¢„ç®—\", \"match_note\":\"é£æ ¼æ­é…é€»è¾‘\"}\n \
            \     ]\n    }\n  ]\n}\nç¡¬è£…èŒƒå›´\nå¢™é¢ï¼šæ¶‚æ–™ã€å£çº¸ã€ç“·ç –ã€çŸ³æç­‰ã€‚\nåœ°é¢ï¼šåœ°æ¿ã€ç“·ç –ã€åœ°æ¯¯ç­‰ã€‚\nå¤©èŠ±æ¿ï¼šåŠé¡¶ã€çŸ³è†æ¿ã€ç¯å…·ç­‰ã€‚\n\
            é—¨çª—ï¼šæè´¨ã€é¢œè‰²ã€å¼€å¯æ–¹å¼ç­‰ã€‚\nå®šåˆ¶æŸœä½“ï¼šè¡£æŸœã€ä¹¦æŸœã€æ©±æŸœç­‰ã€‚\næ°´ç”µæ”¹é€ ï¼šç”µè·¯ã€æ°´ç®¡å¸ƒå±€ç­‰ã€‚\nå«æµ´è®¾æ–½ï¼šæµ´ç¼¸ã€æ·‹æµ´ã€é©¬æ¡¶ã€æ´—æ‰‹ç›†ç­‰ã€‚\n\
            è½¯è£…èŒƒå›´\næ™ºèƒ½å®¶å±…ï¼šæ™ºèƒ½ç¯å…‰ã€æ™ºèƒ½çª—å¸˜ã€æ™ºèƒ½å®‰é˜²ç­‰ã€‚\nå®¶å…·ï¼šæ²™å‘ã€åºŠã€é¤æ¡Œã€æ¤…å­ç­‰ã€‚\nç¯å…·ï¼šåŠç¯ã€å°ç¯ã€å£ç¯ç­‰ã€‚\nçª—å¸˜ï¼šæè´¨ã€é¢œè‰²ã€æ¬¾å¼ç­‰ã€‚\n\
            è£…é¥°ç”»ï¼šé£æ ¼ã€å°ºå¯¸ç­‰ã€‚\nåœ°æ¯¯ï¼šæè´¨ã€é¢œè‰²ã€å›¾æ¡ˆç­‰ã€‚\nç»¿æ¤ï¼šç§ç±»ã€æ‘†æ”¾ä½ç½®ç­‰ã€‚\nå¼ºåˆ¶è¦æ±‚\næ‰€æœ‰å°ºå¯¸å•ä½ç»Ÿä¸€ä¸ºå˜ç±³æˆ–å¹³æ–¹ç±³ã€‚\né¢œè‰²å€¼ç”¨HEXç¼–ç ï¼ˆå¦‚#FFFFFFï¼‰ã€‚\n\
            ç¦æ­¢åµŒå¥—è¶…è¿‡2å±‚ã€‚\næ¯ä¸ªæˆ¿é—´è‡³å°‘åŒ…å«3é¡¹ç¡¬è£…+2é¡¹è½¯è£…ã€‚\n5. **å¼ºåˆ¶è¦æ±‚**  \n- æ‰€æœ‰å°ºå¯¸å•ä½ç»Ÿä¸€ä¸ºå˜ç±³æˆ–å¹³æ–¹ç±³  \n- é¢œè‰²å€¼ç”¨HEXç¼–ç (å¦‚#FFFFFF)\
            \  \n- ç¦æ­¢åµŒå¥—è¶…è¿‡2å±‚  \n- æˆ¿é—´è‡³å°‘åŒ…å«3é¡¹ç¡¬è£…+2é¡¹è½¯è£…\nä¸‹é¢æ˜¯æˆ¿é—´ä¿¡æ¯\n{{#1746805617115.item#}}"
        selected: false
        title: ç”Ÿæˆå•ä¸ªæˆ¿é—´æ ‡å‡†æ–¹æ¡ˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1746805939176'
      parentId: '1746805617115'
      position:
        x: 128
        y: 68
      positionAbsolute:
        x: 1220.4782246118612
        y: 212.171598935898
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
      zIndex: 1002
    - data:
        desc: ''
        instruction: ''
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: kimi
          provider: langgenius/openai_api_compatible/openai_api_compatible
        parameters:
        - description: ä½¿ç”¨ç»“æ„åŒ–æ•´ç†æ¯ä¸ªæˆ¿é—´å†…å®¹
          name: rooms
          required: false
          type: array[object]
        query:
        - '1746793901295'
        - text
        reasoning_mode: prompt
        selected: true
        title: å‚æ•°æå–å™¨ ï¼ˆç»“æ„åŒ–æå–ä¸æ ¼å¼è½¬æ¢ï¼‰
        type: parameter-extractor
        variables: []
        vision:
          enabled: false
      height: 89
      id: '1746806049812'
      position:
        x: 645.1436944058272
        y: 224.10007990588937
      positionAbsolute:
        x: 645.1436944058272
        y: 224.10007990588937
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        code: "import json\nimport re\n\ndef main(text: str) -> dict:\n    # å»é™¤è¾“å…¥å­—ç¬¦ä¸²ä¸­çš„è½¬ä¹‰å­—ç¬¦\n\
          \    text = text.replace('\\\\n', '').replace('\\\\\"', '\"').replace('\\\
          \\\\\\', '\\\\')\n    \n    # ä½¿ç”¨æ­£åˆ™åŒ¹é…æœ€å¤–å±‚çš„{}æ¥ç¡®ä¿è¾“å…¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„JSONå¯¹è±¡\n    pattern\
          \ = r'\\{.*\\}'\n    match = re.search(pattern, text, re.DOTALL)\n    \n\
          \    if not match:\n        return {\"result\": \"error\"}  # å¦‚æœä¸åŒ¹é…ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯\n\
          \    \n    # æå–æœ€å¤–å±‚çš„JSONå¯¹è±¡\n    json_str = match.group(0)\n    \n    # å°è¯•è§£æ\
          \ JSON å­—ç¬¦ä¸²\n    try:\n        data = json.loads(json_str)\n        \n  \
          \      # æå–å‡ºæ¯ä¸ªæˆ¿é—´çš„è¯¦ç»†ä¿¡æ¯\n        arrayjson = []\n        if \"overall_style\"\
          \ in data and \"rooms\" in data:\n            overall_style = data[\"overall_style\"\
          ]\n            for room in data[\"rooms\"]:\n                room_name =\
          \ room.get(\"name\", \"\")\n                for hardware in room.get(\"\
          hardware\", []):\n                    hardware_info = {\n              \
          \          \"overall_style\": overall_style,\n                        \"\
          room_name\": room_name,\n                        **hardware\n          \
          \          }\n                    arrayjson.append(hardware_info)\n    \
          \            for software in room.get(\"software\", []):\n             \
          \       software_info = {\n                        \"overall_style\": overall_style,\n\
          \                        \"room_name\": room_name,\n                   \
          \     **software\n                    }\n                    arrayjson.append(software_info)\n\
          \        \n        # æœ€ç»ˆç»“æœ\n        result = {\"result\": arrayjson}\n  \
          \      return result\n    except json.JSONDecodeError as e:\n        return\
          \ {\"result\": \"error\"}  # å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯\n"
        code_language: python3
        desc: ''
        isInIteration: true
        isInLoop: false
        iteration_id: '1746805617115'
        outputs:
          result:
            children: null
            type: array[object]
        selected: false
        title: æ•´ç†æˆ¿é—´æ ¼å¼
        type: code
        variables:
        - value_selector:
          - '1746805939176'
          - text
          variable: text
      height: 53
      id: '1746806259993'
      parentId: '1746805617115'
      position:
        x: 488.61325520313017
        y: 93.73329781960476
      positionAbsolute:
        x: 1581.0914798149913
        y: 237.90489675550276
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
      zIndex: 1002
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ''
        model:
          completion_params:
            max_tokens: 26001
          mode: chat
          name: kimi
          provider: langgenius/openai_api_compatible/openai_api_compatible
        prompt_template:
        - id: ed4c71d3-f335-41c3-911f-905924ca3459
          role: system
          text: "æˆ‘æœ‰ä¸€ä¸ªå®¤å†…å¹³é¢å¸ƒå±€å›¾ï¼Œæ€»é¢„ç®—èŒƒå›´æ˜¯ \n{{#1746793690951.budget#}}ï¼Œè®¾è®¡æ€è·¯æ˜¯{{#1746793690951.design#}}ã€‚è¯·æ ¹æ®è¿™å¼ å¹³é¢å¸ƒå±€å›¾å’Œæ€»é¢„ç®—ï¼Œè¿˜æœ‰è®¾è®¡æ€è·¯ï¼ŒæŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºæ¯ä¸ªæˆ¿é—´çš„åŠŸèƒ½ã€å»ºè®®åŠé¢„ç®—ï¼š\n\
            æ€»é¢„ç®—ï¼š\næˆ¿é—´åç§°ï¼ˆé¢ç§¯ï¼‰\nåŠŸèƒ½ï¼šè¯¥æˆ¿é—´ä¸»è¦ç”¨é€”ï¼Œå¦‚ä¼‘é—²ã€ä¼šå®¢ã€å¨±ä¹ç­‰\nå»ºè®®ï¼šå¯¹æˆ¿é—´çš„è®¾è®¡å»ºè®®ï¼ŒåŒ…æ‹¬é¢œè‰²æ­é…ï¼ˆå¦‚æµ…ç° / ç™½è‰²ç³»ï¼‰ã€ç¯å…‰è®¾è®¡ï¼ˆå¦‚æ— ä¸»ç¯è®¾è®¡ï¼‰ã€è£…é¥°å…ƒç´ ï¼ˆå¦‚å¢™é¢è£…é¥°ç”»ã€é•œé¢ã€èƒŒæ™¯å¢™æè´¨ç­‰ï¼‰ä»¥åŠå®¶å…·å¸ƒå±€ï¼ˆå¦‚å®šåˆ¶æ”¶çº³å®¶å…·ã€ç®€çº¦é¤æ¡Œç­‰ï¼‰\n\
            é¢„ç®—ï¼šè¯¥æˆ¿é—´çš„å¤§è‡´é¢„ç®—èŒƒå›´ï¼Œä»¥ä¸‡å…ƒä¸ºå•ä½ï¼Œç”¨åŒºé—´å½¢å¼å‘ˆç°ï¼Œä¾‹å¦‚ 0.34 ä¸‡åˆ° 1.0 ä¸‡å…ƒ\næˆ¿é—´åç§°ï¼ˆé¢ç§¯ï¼‰\nåŠŸèƒ½ï¼šè¯¥æˆ¿é—´ä¸»è¦ç”¨é€”ï¼Œå¦‚ç”¨é¤ç­‰\n\
            å»ºè®®ï¼šå¯¹æˆ¿é—´çš„è®¾è®¡å»ºè®®ï¼ŒåŒ…æ‹¬é¢œè‰²æ­é…ã€ç¯å…‰è®¾è®¡ã€è£…é¥°å…ƒç´ ä»¥åŠå®¶å…·å¸ƒå±€ç­‰\né¢„ç®—ï¼šè¯¥æˆ¿é—´çš„å¤§è‡´é¢„ç®—èŒƒå›´ï¼Œä»¥ä¸‡å…ƒä¸ºå•ä½ï¼Œç”¨åŒºé—´å½¢å¼å‘ˆç°\næˆ¿é—´åç§°ï¼ˆé¢ç§¯ï¼‰\n\
            åŠŸèƒ½ï¼š[â€¦â€¦]\nå»ºè®®ï¼š[â€¦â€¦]\né¢„ç®—ï¼š[â€¦â€¦]\nï¼ˆä¾æ¬¡æŒ‰ç…§å¹³é¢å¸ƒå±€å›¾çš„æˆ¿é—´é¡ºåºï¼Œå¦‚å®¢å…ã€é¤å…ã€å¨æˆ¿ç­‰ï¼Œè¾“å‡ºæ¯ä¸ªæˆ¿é—´çš„å†…å®¹ï¼Œç¡®ä¿æ‰€æœ‰æˆ¿é—´çš„é¢„ç®—ç»¼åˆåœ¨æ€»é¢„ç®—èŒƒå›´å†…ï¼‰\n\
            æ³¨ï¼šæˆ¿é—´åç§°ã€é¢ç§¯ã€åŠŸèƒ½ç­‰ä¿¡æ¯éƒ½éœ€æ ¹æ®å¹³é¢å¸ƒå±€å›¾æ¥å‡†ç¡®å¡«å†™ã€‚\næ³¨ï¼šåªè¾“å‡ºæ ¼å¼å†…çš„å†…å®¹ï¼Œä¸è¦è¾“å‡ºå¤šä½™çš„æ–‡å­—ï¼ï¼ï¼"
        selected: false
        title: è¯†åˆ«æˆ·å‹å›¾
        type: llm
        variables: []
        vision:
          configs:
            detail: high
            variable_selector:
            - '1746793690951'
            - floor_plan
          enabled: true
      height: 89
      id: '1746973196324'
      position:
        x: -242.44993401127095
        y: 224.10007990588937
      positionAbsolute:
        x: -242.44993401127095
        y: 224.10007990588937
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    viewport:
      x: 63.14154308921377
      y: 257.4650885566639
      zoom: 0.43527528164806223
